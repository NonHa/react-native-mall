<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.non.my_mall.dao.OmsOrderDao">
    <select id="getList" resultMap="com.non.my_mall.mbg.mapper.OmsOrderMapper.BaseResultMap">
        select * from oms_order where delete_status = 0
        <if test="queryParam.orderSn != null and queryParam.orderSn != ''">
            and order_sn = #{queryParam.orderSn}
        </if>
        <if test="queryParam.status != null and queryParam.status != ''">
            and status = #{queryParam.status}
        </if>
        <if test="queryParam.orderType != null and queryParam.orderType != ''">
            and order_type = #{queryParam.orderType}
        </if>
        <if test="queryParam.sourceType != null ">
            and source_type = #{queryParam.sourceType}
        </if>
        <if test="queryParam.createTime != null">
            and  create_time like concat(STR_TO_DATE(#{queryParam.createTime},'%Y-%m-%d') , "%")
        </if>
        <if test="queryParam.receiverKeyWord != null and queryParam.receiverKeyWord != ''">
            and (
                receiver_name like concat("%", #{queryParam.receiverKeyWord}, "%")
                or receiver_phone like concat("%", #{queryParam.receiverKeyWord}, "%")
            )
        </if>
    </select>

    <update id="delete">
        update oms_order set delete_status = 1 where id = #{id}
    </update>

    <insert id="generate" parameterType="com.non.my_mall.mbg.model.OmsOrder">
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into oms_order (
            member_id,
            order_sn,
            coupon_id,
            create_time,
            member_username,
            total_amount,
            pay_type,
            source_type,
            status,
            order_type,
            auto_confirm_day,
            integration,
            growth,
            promotion_info,
            receiver_name,
            receiver_phone

        ) value (
            #{memberId},
            #{orderSn},
            #{couponId},
            #{createTime},
            #{memberUsername},
            #{totalAmount},
            #{payType},
            #{sourceType},
            #{status},
            #{orderType},
            #{autoConfirmDay},
            #{integration},
            #{growth},
            #{promotionInfo},
            #{receiverName},
            #{receiverPhone}
        )
    </insert>
</mapper>