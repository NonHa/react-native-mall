<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.non.my_mall.dao.OmsCarItemDao">
    <insert id="add" parameterType="com.non.my_mall.mbg.model.OmsCartItem">
        insert into oms_cart_item (quantity, price,product_id,product_name,member_id, create_date,modify_date, product_sku_id) value
            (#{quantity}, #{price}, #{productId},#{productName},#{memberId},#{createDate},#{modifyDate}, #{productSkuId})
    </insert>

    <update id="update" parameterType="com.non.my_mall.mbg.model.OmsCartItem">
        update oms_cart_item
            <set>
                <if test="quantity != null">
                    quantity=#{quantity},
                </if>
                <if test="price != null">
                    price=#{price},
                </if>
                <if test="productSkuCode != null">
                    product_sku_code=#{productSkuCode},
                </if>
                <if test="productAttr != null">
                    product_attr=#{productAttr},
                </if>

                <if test="createDate != null">
                    create_date=#{createDate},
                </if>
                <if test="modifyDate != null">
                    modify_date=#{modifyDate}
                </if>
            </set>
            where  id=#{id}
    </update>

    <resultMap id="ListResultMap" type="com.non.my_mall.dto.OmsCarItemListDetail" extends="com.non.my_mall.mbg.mapper.OmsCartItemMapper.BaseResultMap">
        <collection property="productList" columnPrefix="pro_" resultMap="com.non.my_mall.mbg.mapper.OmsCartItemMapper.BaseResultMap"></collection>
    </resultMap>
    <select id="getList" resultMap="ListResultMap">
        select
               c1.*,
               c2.id pro_id,
               c2.product_id pro_product_id,
               c2.product_sku_id pro_product_sku_id,
               c2.quantity pro_quantity,
               c2.price pro_price,
               c2.product_name pro_product_name,
               c2.product_id pro_product_id,
               c2.product_sub_title pro_product_sub_title,
               c2.product_attr pro_product_attr,
               c2.product_pic pro_product_pic
        from (select * from oms_cart_item c group by c.product_brand)  c1
        left join oms_cart_item c2 on c1.product_brand = c2.product_brand
        where c1.member_id = #{memberId}
    </select>
</mapper>