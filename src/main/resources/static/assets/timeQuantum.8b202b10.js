var se=Object.defineProperty,ne=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var Z=(l,s,t)=>s in l?se(l,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[s]=t,x=(l,s)=>{for(var t in s||(s={}))ie.call(s,t)&&Z(l,t,s[t]);if(M)for(var t of M(s))ue.call(s,t)&&Z(l,t,s[t]);return l},E=(l,s)=>ne(l,le(s));var I=(l,s,t)=>new Promise((v,c)=>{var u=f=>{try{p(t.next(f))}catch(g){c(g)}},_=f=>{try{p(t.throw(f))}catch(g){c(g)}},p=f=>f.done?v(f.value):Promise.resolve(f.value).then(u,_);p((t=t.apply(l,s)).next())});import{d as W,a as n,r as X,K as Y,o as R,q as D,e as r,w as i,f as e,c8 as ee,c as K,Z as N,h as S,i as te,p as re,$ as ce,al as de,am as me,x as fe,s as pe}from"./index.9ea39232.js";import{E as he}from"./el-switch.05966c42.js";import{u as O,B as j}from"./useTable.db1db6c5.js";import{r as ae,B as ge}from"./useForm.c467aa96.js";import{e as ve,f as _e,h as ye,i as Re,j as Se,k as Ce,l as ke,m as be,n as H,o as Fe,p as Pe,q as we,r as Te}from"./promotion.0520d05c.js";import{B as oe}from"./index.4c756888.js";import{b as J}from"./dateUtil.648bdb8e.js";import{c as Ie}from"./table.e172cbb0.js";const ze=S("\u65B0\u589E"),Be=S("\u7F16\u8F91"),$e=S("\u5220\u9664"),xe=W({__name:"flashProduct",props:{flashProductQuery:{type:Object}},setup(l){const s=l,t=n(!1),v=n(!1);n();const c=n({}),u=n(!1),_=n(0),p=n([]),f=n([]),g=X({pageSize:10,pageNum:1}),C=Ie;p.value=ve;let k=ye;const z=()=>{};Y(()=>s.flashProductQuery,()=>{y()},{deep:!0});function b(d,a){_.value=a,c.value=d&&d.id?d:{status:1},e(v).visibleRef=!0}const[V,U]=ae();let F=Re();const[Q,{getForm:P,reload:y}]=O({api:k,columns:F,showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!1,rowKey:"key"}),[w,{getSelectRows:A}]=O({api:C,columns:F,showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!1,rowKey:"key"});let q=d=>I(this,null,function*(){if(e(_)===2)Se(E(x({},U.getFieldsValue()),{id:e(c).id})).then(a=>{if(a)return e(v).visibleRef=!1,y(),!0});else{let a=A().map(o=>({productId:o.id,flashPromotionId:s.flashProductQuery.promotionId,flashPromotionSessionId:s.flashProductQuery.sessionId}));Ce(a).then(o=>{if(o)return e(v).visibleRef=!1,y(),!0})}return!1});function B(d,a){c.value=d,_.value=2,ke({id:d.id}).then(o=>{o.code===200&&y()})}const L=d=>d.map(a=>E(x({},a),{name:a.product.name,productSn:a.product.productSn,stock:a.product.stock,price:a.product.price}));let T=[];return(d,a)=>{const o=te;return R(),D(N,null,[r(o,{size:"small",type:"primary",onClick:b},{default:i(()=>[ze]),_:1}),r(e(j),{columns:e(F),dataSource:e(T),canResize:t.value,loading:u.value,showTableSetting:"",api:e(k),searchInfo:s.flashProductQuery,afterFetch:L,onRegister:e(Q)},{"col-oprate":i(({row:m,column:h})=>[r(o,{size:"small",type:"primary",onClick:$=>b(m,2)},{default:i(()=>[Be]),_:2},1032,["onClick"]),r(e(ee),{title:"Are you sure to delete this?",onConfirm:$=>B(m)},{reference:i(()=>[r(o,{size:"small",type:"danger"},{default:i(()=>[$e]),_:1})]),_:2},1032,["onConfirm"])]),_:1},8,["columns","dataSource","canResize","loading","api","searchInfo","onRegister"]),r(e(oe),{ref_key:"modalRef",ref:v,onOk:a[0]||(a[0]=m=>e(q)("edit"))},{default:i(()=>[_.value===2?(R(),K(e(ge),{key:0,onRegister:e(V),model:c.value,schemas:p.value,showActionBtn:!1},null,8,["onRegister","model","schemas"])):(R(),K(e(j),{key:1,columns:e(_e)(),dataSource:f.value,canResize:t.value,loading:u.value,pagination:g,api:e(C),rowSelection:{type:"checkbox"},columnSelectInit:{selectable:z},onRegister:e(w)},null,8,["columns","dataSource","canResize","loading","pagination","api","columnSelectInit","onRegister"]))]),_:1},512)],64)}}}),Ee=S("\u65B0\u589E"),De=S(" \u5546\u54C1\u5217\u8868 "),Ve=S("\u7F16\u8F91"),Qe=S("\u5220\u9664"),Ae={key:0},Ze=W({__name:"timeQuantum",props:{promotionRow:{type:Object}},setup(l,{expose:s}){const t=l,v=n(!1),c=n(!1),u=n({}),_=n(!1),p=n(0),f=n([]),g=n(),C=n({}),k=X({promotionId:0,sessionId:0});let z=n([]);const b=n([]);f.value=be,Y(()=>t==null?void 0:t.promotionRow,a=>{y()},{deep:!0});const[V,{getForm:U,reload:F,setColumns:Q}]=O({columns:b.value,showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!1,rowKey:"key",isTreeTable:!0}),P=re(()=>!!(t!=null&&t.promotionRow.id));b.value=H(P.value);const y=()=>I(this,null,function*(){k.promotionId=t==null?void 0:t.promotionRow.id,t!=null&&t.promotionRow.id?(g.value=Fe,C.value={flashPromotionId:t==null?void 0:t.promotionRow.id}):(g.value=Pe,C.value={}),ce(()=>{Q(H(P.value))});const a=yield g.value(C.value);z.value=a.data.list});y();function w(a,o){p.value=o,k.sessionId=a.id,u.value=a&&a.id?a:{status:1},e(c).visibleRef=!0}function A(a){}const[q,B]=ae();function L(a){return I(this,null,function*(){return u.value=a,p.value=2,e(u).status=e(u).status===0?1:0,yield T()})}let T=a=>I(this,null,function*(){if(e(u).id){let o=a?E(x({},B.getFieldsValue()),{id:e(u).id}):e(u);o.startDate=J(o.startDate),o.endDate=J(o.endDate),yield we(o).then(m=>{if(m)return e(c).visibleRef=!1,F(),!0})}else{let o=B.getFieldsValue();Te(o).then(m=>{if(m)return e(c).visibleRef=!1,F(),!0})}return!1});function d(a,o){u.value=a,p.value=2,e(u).status=0,T()}return s({toggleCanResize:w}),(a,o)=>{const m=te;return R(),D(N,null,[r(e(j),{columns:b.value,dataSource:e(z),canResize:v.value,loading:_.value,onColumnsChange:A,onRegister:e(V)},{"form-advanceBefore":i(()=>[r(m,{type:"danger",onClick:w},{default:i(()=>[Ee]),_:1})]),"col-operate":i(({row:h,column:$})=>[e(P)?(R(),K(m,{key:0,size:"small",type:"primary",onClick:G=>w(h,1)},{default:i(()=>[De]),_:2},1032,["onClick"])):(R(),D(N,{key:1},[r(m,{size:"small",type:"primary",onClick:G=>w(h,2)},{default:i(()=>[Ve]),_:2},1032,["onClick"]),r(e(ee),{title:"Are you sure to delete this?",onConfirm:G=>d(h)},{reference:i(()=>[r(m,{size:"small",type:"danger"},{default:i(()=>[Qe]),_:1})]),_:2},1032,["onConfirm"])],64))]),"col-status":i(({row:h})=>[de(r(e(he),{modelValue:h.status,"onUpdate:modelValue":$=>h.status=$,class:"ml-2","active-value":1,"inactive-value":0,"before-change":()=>L(h)},null,8,["modelValue","onUpdate:modelValue","before-change"]),[[me,!e(P)]]),e(P)?(R(),D("div",Ae,fe(h.productCount),1)):pe("",!0)]),_:1},8,["columns","dataSource","canResize","loading","onRegister"]),r(e(oe),{ref_key:"modalRef",ref:c,onOk:o[0]||(o[0]=h=>e(T)("edit"))},{default:i(()=>[r(xe,{flashProductQuery:k},null,8,["flashProductQuery"])]),_:1},512)],64)}}});export{Ze as _};
