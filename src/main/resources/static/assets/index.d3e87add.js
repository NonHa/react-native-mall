var X=Object.defineProperty,Y=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var q=(n,o,a)=>o in n?X(n,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[o]=a,U=(n,o)=>{for(var a in o||(o={}))te.call(o,a)&&q(n,a,o[a]);if(O)for(var a of O(o))le.call(o,a)&&q(n,a,o[a]);return n},M=(n,o)=>Y(n,ee(o));var I=(n,o,a)=>new Promise((z,l)=>{var k=s=>{try{h(a.next(s))}catch(t){l(t)}},c=s=>{try{h(a.throw(s))}catch(t){l(t)}},h=s=>s.done?z(s.value):Promise.resolve(s.value).then(k,c);h((a=a.apply(n,o)).next())});import{e as p,h as x,d as L,di as W,h3 as ae,a as y,V as Z,$,K as H,o as g,c as E,f as e,h4 as oe,w as m,q as j,a_ as G,Z as N,r as ne,c8 as se,ad as re,h5 as ue,h6 as ie,h7 as ce,h8 as de,i as me,h9 as pe,ha as he}from"./index.9ea39232.js";import{E as fe}from"./el-switch.05966c42.js";import{u as _e,B as ye}from"./useTable.db1db6c5.js";import{y as Q,z as ge,K as ke,E as Ce,r as be,B as ve}from"./useForm.c467aa96.js";import{B as Re}from"./index.4c756888.js";import{a as Ke,E as Ee}from"./el-descriptions-item.23496ac0.js";/* empty css               */import"./el-popper.9aa5ade8.js";/* empty css                  */import"./el-input-number.e6179de6.js";import"./check.8d7cf096.js";import"./dateUtil.648bdb8e.js";import"./useWindowSizeFn.4d8673c8.js";import"./onMountedOrActivated.21e8b91f.js";import"./el-divider.c329bdb5.js";import"./sortable.esm.6991fe44.js";import"./log.b69fc4f1.js";import"./uniqBy.067f2c9d.js";import"./el-form-item.f36f1992.js";import"./uniq.030252d7.js";/* empty css                 */import"./el-space.f4d2670a.js";function xe(){return[{label:"\u7F16\u53F7",prop:"id",fixed:"left"},{label:"\u89D2\u8272\u540D\u79F0",prop:"name",width:150},{label:"\u63CF\u8FF0",prop:"description",width:150},{label:"\u7528\u6237\u6570",prop:"adminCount"},{label:"\u63D0\u4EA4\u65F6\u95F4",prop:"createTime"},{label:"\u662F\u5426\u542F\u7528",prop:"status",slot:!0},{label:"\u64CD\u4F5C",prop:"operate",slot:!0,width:400}]}const Ae=()=>[{field:"keyword",label:"\u8BA2\u5355\u7F16\u53F7",component:"ElInput",colProps:{xl:24,lg:24}}],Ve=[{field:"name",label:"\u89D2\u8272\u540D\u79F0",component:"ElInput",colProps:{xl:24,lg:24}},{field:"description",label:"\u63CF\u8FF0",component:"ElInputTextArea",colProps:{xl:24,lg:24}},{field:"status",label:"\u662F\u5426\u542F\u7528",component:"ElSelect",colProps:{xl:24,lg:24},render:(n,o)=>p(ge,{modelValue:o.status,"onUpdate:modelValue":a=>o.status=a},{default:()=>[p(Q,{label:1,size:"large"},{default:()=>[x("\u662F")]}),p(Q,{label:0,size:"large"},{default:()=>[x("\u5426")]})]})}];function Be(){return{labelWidth:100,schemas:[...Ae()]}}const Ie=L({__name:"menu",props:{menuAutoCheckKeys:{type:Array}},setup(a,z){return I(this,arguments,function*(n,{expose:o}){let l,k;const c=n,{data:h}=([l,k]=W(()=>ae()),l=yield l,k(),l),s={children:"children",label:"label"},t=y();Z(()=>{$(()=>{t.value.setCheckedKeys(c.menuAutoCheckKeys)})}),H(()=>c.menuAutoCheckKeys,()=>{$(()=>{t.value.setCheckedKeys(c.menuAutoCheckKeys)})});const C=h.list.map(b=>({id:b.id,label:b.title,children:b.children.map(V=>({id:V.id,label:V.title}))}));return o({getCheckedKeys:()=>e(t).getCheckedKeys()}),(b,V)=>{const r=ke;return g(),E(r,{ref_key:"treeRef",ref:t,data:e(C),"show-checkbox":"","node-key":"id",props:s,"default-expand-all":""},null,8,["data"])}})}}),Se=L({__name:"resource",props:{menuAutoCheckKeys:{type:Array}},setup(a,z){return I(this,arguments,function*(n,{expose:o}){let l,k;const c=n,{data:h}=([l,k]=W(()=>oe()),l=yield l,k(),l),s=y({});let t=y({});Z(()=>{$(()=>{A()})}),H(()=>c.menuAutoCheckKeys,()=>{A()});const C=h.list.map(r=>M(U({},r),{childrenIds:r.children.map(v=>v.id)})),A=()=>{$(()=>{t.value={},s.value={},C.forEach(r=>{let v=new Set([...c.menuAutoCheckKeys,...r.childrenIds]);s.value[r.id]=[...v].length===c.menuAutoCheckKeys.length}),c.menuAutoCheckKeys.forEach(r=>{t.value[r]=!0})})},b=(r,v)=>{let R=C.findIndex(B=>B.id===v);C[R].children.forEach(B=>{t.value[B.id]=r})};return o({getCheckedKeys:()=>Object.keys(t.value)}),(r,v)=>{const R=Ce,T=Ke,B=Ee;return g(),E(B,{direction:"vertical",column:1,border:""},{default:m(()=>[(g(!0),j(N,null,G(e(C),(K,D)=>(g(),E(T,{key:D},{label:m(()=>[p(R,{modelValue:s.value[K.id],"onUpdate:modelValue":f=>s.value[K.id]=f,label:K.name,size:"large",onChange:f=>b(f,K.id)},null,8,["modelValue","onUpdate:modelValue","label","onChange"])]),default:m(()=>[(g(!0),j(N,null,G(K.children,(f,F)=>(g(),E(R,{modelValue:e(t)[f.id],"onUpdate:modelValue":P=>e(t)[f.id]=P,label:f.name,size:"large",key:F},null,8,["modelValue","onUpdate:modelValue","label"]))),128))]),_:2},1024))),128))]),_:1})}})}}),we=x("\u65B0\u589E"),ze=x("\u5206\u914D\u83DC\u5355"),Te=x("\u5206\u914D\u8D44\u6E90"),Fe=x("\u7F16\u8F91"),Ue=x("\u5220\u9664"),st=L({__name:"index",setup(n){const o=y(!1),a=y(!1),z=y(),l=y({}),k=y(!1),c=y(),h=y([]),s=ne({pageSize:10,pageNum:1});let t=y(0),C=re;function A(u,i){t.value=i,l.value=u&&u.id?u:{status:1},e(a).visibleRef=!0}function b(u){}const[V,r]=be();function v(){}let R=xe();R[1].editEvnets={input:v};const[T,{getForm:B,reload:K}]=_e({api:C,columns:R,useSearchForm:!0,formConfig:U({},Be()),showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!1,rowKey:"key",isTreeTable:!0});function D(u){return I(this,null,function*(){return l.value=u,t.value=3,e(l).status=e(l).status===0?1:0,yield f(null)})}let f=u=>I(this,null,function*(){if(e(t)===1||e(t)===2){let i=e(t)===1?ue:ie,_=e(t)===1?c:z,d=e(t)===1?"menuIds":"resourceIds";i({roleId:e(l).id,[d]:_.value.getCheckedKeys().join()}).then(S=>{S.code===200&&(h.value=[],e(a).visibleRef=!1)})}else{if(e(l).id){let i=u?M(U({},r.getFieldsValue()),{id:e(l).id}):e(l);yield ce(i).then(_=>{if(_)return e(a).visibleRef=!1,K(),!0})}else de(r.getFieldsValue()).then(i=>{if(i)return e(a).visibleRef=!1,K(),!0});return!1}});const F=(u,i)=>I(this,null,function*(){let _=i===1?pe:he,{data:d}=yield _({roleId:u.id});h.value=d.list.map(S=>S.id),t.value=i,l.value=u,e(a).visibleRef=!0});function P(u,i){l.value=u,e(l).status=0,f(null)}let J=[];return(u,i)=>{const _=me;return g(),j(N,null,[p(e(ye),{columns:e(R),dataSource:e(J),canResize:o.value,loading:k.value,showTableSetting:"",pagination:s,tableSearchQuery:{pageNum:1,pageSize:50},api:e(C),useSearchForm:"",onColumnsChange:b,onRegister:e(T)},{"form-advanceBefore":m(()=>[p(_,{type:"danger",onClick:A},{default:m(()=>[we]),_:1})]),"col-operate":m(({row:d,column:S})=>[p(_,{size:"small",type:"primary",onClick:w=>F(d,1)},{default:m(()=>[ze]),_:2},1032,["onClick"]),p(_,{size:"small",type:"primary",onClick:w=>F(d,2)},{default:m(()=>[Te]),_:2},1032,["onClick"]),p(_,{size:"small",type:"primary",onClick:w=>A(d,3)},{default:m(()=>[Fe]),_:2},1032,["onClick"]),p(e(se),{title:"Are you sure to delete this?",onConfirm:w=>P(d)},{reference:m(()=>[p(_,{size:"small",type:"danger"},{default:m(()=>[Ue]),_:1})]),_:2},1032,["onConfirm"])]),"col-status":m(({row:d,column:S})=>[p(e(fe),{modelValue:d.status,"onUpdate:modelValue":w=>d.status=w,class:"ml-2","active-value":1,"inactive-value":0,"before-change":()=>D(d)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1},8,["columns","dataSource","canResize","loading","pagination","api","onRegister"]),p(e(Re),{ref_key:"modalRef",ref:a,onOk:i[0]||(i[0]=d=>e(f)("edit"))},{default:m(()=>[e(t)===1?(g(),E(Ie,{key:0,ref_key:"menuRef",ref:c,menuAutoCheckKeys:h.value},null,8,["menuAutoCheckKeys"])):e(t)===2?(g(),E(Se,{key:1,ref_key:"resouceRef",ref:z,menuAutoCheckKeys:h.value},null,8,["menuAutoCheckKeys"])):(g(),E(e(ve),{key:2,onRegister:e(V),model:l.value,schemas:e(Ve),showActionBtn:!1},null,8,["onRegister","model","schemas"]))]),_:1},512)],64)}}});export{st as default};
