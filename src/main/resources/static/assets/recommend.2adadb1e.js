var P=Object.defineProperty,Q=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var x=(n,t,e)=>t in n?P(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,q=(n,t)=>{for(var e in t||(t={}))A.call(t,e)&&x(n,e,t[e]);if(w)for(var e of w(t))G.call(t,e)&&x(n,e,t[e]);return n},z=(n,t)=>Q(n,Z(t));var b=(n,t,e)=>new Promise((S,u)=>{var r=l=>{try{c(e.next(l))}catch(g){u(g)}},y=l=>{try{c(e.throw(l))}catch(g){u(g)}},c=l=>l.done?S(l.value):Promise.resolve(l.value).then(r,y);c((e=e.apply(n,t)).next())});import{d as H,a as p,r as E,o as R,q as J,e as f,w as m,h as T,x as W,f as a,c8 as X,c as V,Z as Y,i as ee}from"./index.9ea39232.js";import{E as te}from"./el-switch.05966c42.js";import{u as N,B as I}from"./useTable.db1db6c5.js";import{r as ae,B as oe}from"./useForm.c467aa96.js";import{B as ne}from"./index.4c756888.js";const re=T("\u8BBE\u7F6E\u6392\u5E8F"),le=T("\u5220\u9664"),pe=H({__name:"recommend",props:{addTableText:{type:String,required:!0},addColumn:{type:Array,required:!0},addTableApi:{type:Function,required:!0},baseSchema:{type:Array,required:!0},baseColumn:{type:Function,required:!0},baseApi:{type:Object,required:!0},searchSchema:{type:Array,required:!0},addRecommendListBeafore:{type:Function,required:!0}},setup(n){const t=n,{baseApi:e}=t,S=p(!1),u=p(!1),r=p({}),y=p(!1),c=p(0),l=p([]);l.value=t.baseSchema;const g=E({pageSize:10,pageNum:1}),$=E({pageSize:10,pageNum:1});let B=e==null?void 0:e.list;function F(s,o){c.value=o,r.value=s&&s.id?s:{status:1},a(u).visibleRef=!0}const[D,_]=ae();let C=t.baseColumn();const[K,{getForm:se,reload:h}]=N({api:B,columns:C,useSearchForm:!0,formConfig:{schemas:t.searchSchema},showTableSetting:!0,tableSetting:{fullScreen:!0},showIndexColumn:!1,rowKey:"key",isTreeTable:!0}),[L,{getSelectRows:O}]=N({useSearchForm:!0,showIndexColumn:!1,rowKey:"id",isTreeTable:!0});function U(s){return b(this,null,function*(){return r.value=s,c.value=2,a(r).recommendStatus=a(r).recommendStatus===0?1:0,yield k()})}let k=s=>b(this,null,function*(){if(a(c)===3){let o=t.addRecommendListBeafore(O());e==null||e.add(o).then(i=>{i.code===200&&(a(u).visibleRef=!1,h())});return}if(a(r).id){let o=s?z(q({},_.getFieldsValue()),{id:a(r).id}):a(r);yield e==null?void 0:e.update(o).then(i=>{if(i)return a(u).visibleRef=!1,h(),!0})}else{let o=_.getFieldsValue();e==null||e.add(o).then(i=>{if(i)return a(u).visibleRef=!1,h(),!0})}return!1});function j(s){e==null||e.delete({id:s.id}).then(o=>{o.code===200&&h()})}let M=[];return(s,o)=>{const i=ee;return R(),J(Y,null,[f(a(I),{columns:a(C),dataSource:a(M),canResize:S.value,loading:y.value,showTableSetting:"",pagination:g,tableSearchQuery:{pageNum:1,pageSize:50},api:a(B),useSearchForm:"",onRegister:a(K)},{"form-advanceBefore":m(()=>[f(i,{type:"danger",onClick:o[0]||(o[0]=d=>F({},3))},{default:m(()=>[T(W(t.addTableText),1)]),_:1})]),"col-oprate":m(({row:d})=>[f(i,{size:"small",type:"primary",onClick:v=>F(d,1)},{default:m(()=>[re]),_:2},1032,["onClick"]),f(a(X),{title:"Are you sure to delete this?",onConfirm:v=>j(d)},{reference:m(()=>[f(i,{size:"small",type:"danger"},{default:m(()=>[le]),_:1})]),_:2},1032,["onConfirm"])]),"col-recommendStatus":m(({row:d})=>[f(a(te),{modelValue:d.recommendStatus,"onUpdate:modelValue":v=>d.recommendStatus=v,class:"ml-2","active-value":1,"inactive-value":0,"before-change":()=>U(d)},null,8,["modelValue","onUpdate:modelValue","before-change"])]),_:1},8,["columns","dataSource","canResize","loading","pagination","api","onRegister"]),f(a(ne),{ref_key:"modalRef",ref:u,onOk:o[1]||(o[1]=d=>a(k)("edit"))},{default:m(()=>[c.value===3?(R(),V(a(I),{key:0,columns:t.addColumn,showTableSetting:"",pagination:$,api:t.addTableApi,columnSelectInit:{selectable:()=>!0,initSelectRows:[]},rowSelection:{type:"checkbox"},useSearchForm:"",onRegister:a(L)},null,8,["columns","pagination","api","columnSelectInit","onRegister"])):(R(),V(a(oe),{key:1,onRegister:a(D),model:r.value,schemas:l.value,showActionBtn:!1},null,8,["onRegister","model","schemas"]))]),_:1},512)],64)}}});export{pe as _};
